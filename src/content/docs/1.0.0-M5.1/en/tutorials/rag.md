---
title: æ£€ç´¢å¢å¼ºç”ŸæˆRAGï¼ˆRetrieval-Augmented Generationï¼‰
keywords: [Spring AI, RAG, æ¨¡å‹ä¸Šä¸‹æ–‡åè®®, æ™ºèƒ½ä½“åº”ç”¨]
description: "Spring AI æ™ºèƒ½ä½“å¦‚ä½•ä½¿ç”¨RAG"
---
#  RAG ç®€ä»‹

## ä¸€ã€ ä»€ä¹ˆæ˜¯RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰
RAGï¼ˆRetrieval Augmented Generationï¼Œæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰æ˜¯ä¸€ç§ç»“åˆä¿¡æ¯æ£€ç´¢å’Œæ–‡æœ¬ç”Ÿæˆçš„æŠ€æœ¯èŒƒå¼ã€‚

## ğŸŒŸ æ ¸å¿ƒè®¾è®¡ç†å¿µ
RAGæŠ€æœ¯å°±åƒç»™AIè£…ä¸Šäº†ã€Œå®æ—¶ç™¾ç§‘å¤§è„‘ã€ï¼Œé€šè¿‡**å…ˆæŸ¥èµ„æ–™åå›ç­”**çš„æœºåˆ¶ï¼Œè®©AIæ‘†è„±ä¼ ç»Ÿæ¨¡å‹çš„"çŸ¥è¯†é—å¿˜"å›°å¢ƒã€‚

## ğŸ› ï¸ å››å¤§æ ¸å¿ƒæ­¥éª¤

### 1. æ–‡æ¡£åˆ‡å‰² â†’ å»ºç«‹æ™ºèƒ½æ¡£æ¡ˆåº“
- **æ ¸å¿ƒä»»åŠ¡**: å°†æµ·é‡æ–‡æ¡£è½¬åŒ–ä¸ºæ˜“æ£€ç´¢çš„çŸ¥è¯†ç¢ç‰‡
- **å®ç°æ–¹å¼**:
   - å°±åƒæŠŠåšé‡è¯å…¸æ‹†è§£æˆå•è¯å¡ç‰‡
   - é‡‡ç”¨æ™ºèƒ½åˆ†å—ç®—æ³•ä¿æŒè¯­ä¹‰è¿è´¯æ€§
   - ç»™æ¯ä¸ªçŸ¥è¯†ç¢ç‰‡æ‰“æ ‡ç­¾ï¼ˆå¦‚"æŠ€æœ¯è§„æ ¼"ã€"æ“ä½œæŒ‡å—"ï¼‰

> ğŸ“Œ å…³é”®ä»·å€¼ï¼šä¼˜è´¨çš„çŸ¥è¯†åˆ‡å‰²å¦‚åŒå›¾ä¹¦é¦†åˆ†ç±»ç³»ç»Ÿï¼Œå†³å®šäº†åç»­æ£€ç´¢æ•ˆç‡

### 2. å‘é‡ç¼–ç  â†’ æ„å»ºè¯­ä¹‰åœ°å›¾
- **æ ¸å¿ƒè½¬æ¢**:
   - ç”¨AIæ¨¡å‹å°†æ–‡å­—è½¬åŒ–ä¸ºæ•°å­¦å‘é‡
   - ä½¿è¯­ä¹‰ç›¸è¿‘çš„å†…å®¹äº§ç”Ÿç›¸ä¼¼æ•°å­¦ç‰¹å¾
- **æ•°æ®å­˜å‚¨**:
   - æ‰€æœ‰å‘é‡å­˜å…¥ä¸“ç”¨æ•°æ®åº“
   - å»ºç«‹å¿«é€Ÿæ£€ç´¢ç´¢å¼•ï¼ˆç±»ä¼¼å›¾ä¹¦é¦†ä¹¦ç›®æ£€ç´¢ç³»ç»Ÿï¼‰

ğŸ¯ ç¤ºä¾‹æ•ˆæœï¼š"ç»­èˆªæ—¶é—´"å’Œ"ç”µæ± å®¹é‡"ä¼šè¢«ç¼–ç ä¸ºç›¸ä¼¼å‘é‡

### 3. ç›¸ä¼¼æ£€ç´¢ â†’ æ™ºèƒ½èµ„æ–™çŒäºº
**åº”ç­”è§¦å‘æµç¨‹**ï¼š
1. å°†ç”¨æˆ·é—®é¢˜è½¬ä¸º"é—®é¢˜å‘é‡"
2. é€šè¿‡å¤šç»´åº¦åŒ¹é…ç­–ç•¥æœç´¢çŸ¥è¯†åº“ï¼š
   - è¯­ä¹‰ç›¸ä¼¼åº¦
   - å…³é”®è¯åŒ¹é…åº¦
   - æ—¶æ•ˆæ€§æƒé‡
3. è¾“å‡ºæŒ‡å®šä¸ªæ•°æœ€ç›¸å…³æ–‡æ¡£ç‰‡æ®µ

### 4. ç”Ÿæˆå¢å¼º â†’ ä¸“ä¸šæŠ¥å‘Šæ’°å†™
**åº”ç­”æ„å»ºè¿‡ç¨‹**ï¼š
1. å°†æ£€ç´¢ç»“æœä½œä¸ºæŒ‡å®šå‚è€ƒèµ„æ–™
2. AIç”Ÿæˆæ—¶è‡ªåŠ¨å…³è”ç›¸å…³çŸ¥è¯†ç‰‡æ®µã€‚
3. è¾“å‡ºå½¢å¼å¯ä»¥åŒ…å«ï¼š
   - è‡ªç„¶è¯­è¨€å›ç­”
   - é™„å‚è€ƒèµ„æ–™æº¯æºè·¯å¾„

ğŸ“ è¾“å‡ºç¤ºä¾‹ï¼š
> "æ ¹æ®ã€Šäº§å“æ‰‹å†Œv2.3ã€‹ç¬¬5ç« å†…å®¹ï¼šè¯¥è®¾å¤‡ç»­èˆªæ—¶é—´ä¸º..."


## äºŒã€Spring AI æ ‡å‡†æ¥å£å®ç° RAG 

### 2.1 æ ¸å¿ƒå®ç°ä»£ç 

#### é…ç½®ç±»
```java
@Configuration
public class RagConfig {

    @Bean
    ChatClient chatClient(ChatClient.Builder builder) {
        return builder.defaultSystem("ä½ å°†ä½œä¸ºä¸€åæœºå™¨äººäº§å“çš„ä¸“å®¶ï¼Œå¯¹äºç”¨æˆ·çš„ä½¿ç”¨éœ€æ±‚ä½œå‡ºè§£ç­”")
                .build();
    }

    @Bean
    VectorStore vectorStore(EmbeddingModel embeddingModel) {
        SimpleVectorStore simpleVectorStore = SimpleVectorStore.builder(embeddingModel)
                .build();

        // ç”Ÿæˆä¸€ä¸ªæœºå™¨äººäº§å“è¯´æ˜ä¹¦çš„æ–‡æ¡£
        List<Document> documents = List.of(
                new Document("äº§å“è¯´æ˜ä¹¦:äº§å“åç§°ï¼šæ™ºèƒ½æœºå™¨äºº\n" +
                        "äº§å“æè¿°ï¼šæ™ºèƒ½æœºå™¨äººæ˜¯ä¸€ä¸ªæ™ºèƒ½è®¾å¤‡ï¼Œèƒ½å¤Ÿè‡ªåŠ¨å®Œæˆå„ç§ä»»åŠ¡ã€‚\n" +
                        "åŠŸèƒ½ï¼š\n" +
                        "1. è‡ªåŠ¨å¯¼èˆªï¼šæœºå™¨äººèƒ½å¤Ÿè‡ªåŠ¨å¯¼èˆªåˆ°æŒ‡å®šä½ç½®ã€‚\n" +
                        "2. è‡ªåŠ¨æŠ“å–ï¼šæœºå™¨äººèƒ½å¤Ÿè‡ªåŠ¨æŠ“å–ç‰©å“ã€‚\n" +
                        "3. è‡ªåŠ¨æ”¾ç½®ï¼šæœºå™¨äººèƒ½å¤Ÿè‡ªåŠ¨æ”¾ç½®ç‰©å“ã€‚\n"));

        simpleVectorStore.add(documents);
        return simpleVectorStore;
    }


}

```
é€šè¿‡è¿™ä¸ªé…ç½®ç±»ï¼Œå®Œæˆä»¥ä¸‹å†…å®¹ï¼š

1 ã€é…ç½®ChatClientä½œä¸ºBeanï¼Œå…¶ä¸­è®¾ç½®ç³»ç»Ÿé»˜è®¤è§’è‰²ä¸ºæœºå™¨äººäº§å“ä¸“å®¶ï¼Œ è´Ÿè´£å¤„ç†ç”¨æˆ·æŸ¥è¯¢å¹¶ç”Ÿæˆå›ç­”
å‘é‡å­˜å‚¨é…ç½®ã€‚

2ã€åˆå§‹åŒ–SimpleVectorStoreï¼ŒåŠ è½½æœºå™¨äººäº§å“è¯´æ˜ä¹¦æ–‡æ¡£ï¼Œå°†æ–‡æ¡£è½¬æ¢ä¸ºå‘é‡å½¢å¼å­˜å‚¨ã€‚
>SimpleVectorStoreæ˜¯å°†å‘é‡ä¿å­˜åœ¨å†…å­˜ConcurrentHashmapä¸­ï¼ŒSpring AIæä¾›äº†å¤šç§å­˜å‚¨æ–¹å¼ï¼Œå¦‚Redisã€MongoDBç­‰ï¼Œå¯ä»¥æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©é€‚åˆçš„å­˜å‚¨æ–¹å¼ã€‚


#### æ£€ç´¢å¢å¼ºæœåŠ¡
```java
@RestController
@RequestMapping("/ai")
public class RagController {

    @Autowired
    private ChatClient chatClient;

    @Autowired
    private VectorStore vectorStore;


    @PostMapping(value = "/chat", produces = "text/plain; charset=UTF-8")
    public String generation(String userInput) {
        // å‘èµ·èŠå¤©è¯·æ±‚å¹¶å¤„ç†å“åº”
        return chatClient.prompt()
                .user(userInput)
                .advisors(new QuestionAnswerAdvisor(vectorStore))
                .call()
                .content();
    }
}
```
é€šè¿‡æ·»åŠ QuestionAnswerAdvisorå¹¶æä¾›å¯¹åº”çš„å‘é‡å­˜å‚¨ï¼Œå¯ä»¥å°†ä¹‹å‰æ”¾å…¥çš„æ–‡æ¡£ä½œä¸ºå‚è€ƒèµ„æ–™ï¼Œå¹¶ç”Ÿæˆå¢å¼ºå›ç­”ã€‚

### 2.2 è¿è¡Œç¨‹åº
å¯åŠ¨Spring Bootåº”ç”¨ç¨‹åºï¼Œå¹¶è®¿é—®`/ai/chat`æ¥å£ï¼Œä¼ å…¥ç”¨æˆ·é—®é¢˜ï¼Œå³å¯è·å–å¢å¼ºå›ç­”ã€‚å¦‚ä¸‹ï¼š
```bash
POST http://localhost:8080/spring-ai/ai/chat?userInput=æœºå™¨äººæœ‰å“ªäº›åŠŸèƒ½ï¼Ÿ

HTTP/1.1 200 
Content-Type: text/plain;charset=UTF-8

æ ¹æ®æ‚¨æä¾›çš„æ™ºèƒ½æœºå™¨äººäº§å“è¯´æ˜ä¹¦ï¼Œè¯¥æœºå™¨äººçš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š

1. è‡ªåŠ¨å¯¼èˆªï¼šæœºå™¨äººå¯ä»¥è‡ªåŠ¨å¯¼èˆªåˆ°æŒ‡å®šçš„ä½ç½®ã€‚
2. è‡ªåŠ¨æŠ“å–ï¼šæœºå™¨äººèƒ½å¤Ÿè‡ªåŠ¨æŠ“å–ç‰©å“ã€‚
3. è‡ªåŠ¨æ”¾ç½®ï¼šæœºå™¨äººèƒ½å¤Ÿè‡ªåŠ¨æ”¾ç½®ç‰©å“ã€‚

å¦‚æœæ‚¨éœ€è¦æ›´è¯¦ç»†çš„ä¿¡æ¯æˆ–è€…å…³äºå…¶ä»–åŠŸèƒ½çš„é—®é¢˜ï¼Œè¯·æä¾›å…·ä½“çš„éœ€æ±‚ï¼Œæˆ‘ä¼šå°½åŠ›å¸®åŠ©æ‚¨ã€‚

```
è¿™æ ·æµ‹è¯•ç»“æœï¼Œå¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°AIç”Ÿæˆçš„å›ç­”ï¼Œå¹¶å‚è€ƒäº†æœºå™¨äººäº§å“è¯´æ˜ä¹¦ä¸­çš„ç›¸å…³ä¿¡æ¯ã€‚

