---
title: 流式输出概览
description: Spring AI Alibaba Graph 流式处理系统功能概述与技术特性
---

# 流式输出概览

Spring AI Alibaba Graph 提供了完整的流式处理能力，支持实时数据传输和状态更新。通过流式输出，应用程序可以在图执行过程中持续向客户端推送中间结果，而无需等待整个处理流程完成。

## 流式处理概述

流式处理是一种数据传输模式，允许应用程序在数据生成的同时进行传输，而不是等待所有数据准备完毕后再一次性发送。在 AI 应用场景中，这种模式特别适用于：

- 长时间运行的推理任务
- 多步骤的复杂工作流
- 需要实时反馈的交互式应用
- 大规模数据处理任务

## 支持的数据流类型

Spring AI Alibaba Graph 的流式系统支持以下三种主要的数据流类型：

### 工作流状态流
在图的每个节点执行完成后，系统会推送当前的状态信息，包括节点执行结果、状态变更和执行进度等。

### LLM 令牌流
当图中的节点调用大语言模型时，系统可以实时传输模型生成的令牌（token），实现逐字符或逐词的内容展示。

### 自定义数据流
开发者可以在节点执行过程中主动推送自定义的进度信息、状态更新或业务数据。

## 核心技术特性

### 多层级令牌捕获
系统支持从图的任意层级捕获 LLM 令牌流，包括主图节点、嵌套子图以及工具函数内部的模型调用。这种设计确保了无论图结构多么复杂，都能提供完整的流式输出。

### 工具函数进度推送
工具函数可以通过内置的进度回调机制主动推送执行状态：

```java
@Tool("数据查询工具")
public String queryData(String query, ProgressCallback callback) {
    callback.emit("正在连接数据库...");
    // 数据库连接逻辑

    callback.emit("正在执行查询...");
    // 查询执行逻辑

    callback.emit("查询完成，返回结果");
    return result;
}
```

### 嵌套子图流式支持
对于包含多层子图的复杂工作流，系统能够统一管理和同步所有层级的流式输出，确保数据的时序性和完整性。

### 模型适配性
流式处理机制与具体的 LLM 实现解耦，支持各种模型提供商（如通义千问、OpenAI、本地模型等）的流式输出。

### 可配置的流式模式
提供多种流式模式以满足不同的应用需求，从轻量级的状态更新到详细的调试信息输出。

## 流式模式配置

系统提供五种不同的流式模式，开发者可以根据应用需求选择合适的模式或组合使用：

### 模式说明

| 模式 | 数据内容 | 适用场景 | 性能特点 |
|------|----------|----------|----------|
| `values` | 完整状态快照 | 需要完整上下文信息的应用 | 数据量较大，但信息完整 |
| `updates` | 状态增量变更 | 网络带宽受限或高频更新场景 | 数据量小，传输效率高 |
| `custom` | 自定义业务数据 | 特定业务逻辑的进度通知 | 灵活可控，按需定制 |
| `messages` | LLM 令牌和元数据 | 对话式应用和文本生成 | 实时性强，用户体验好 |
| `debug` | 详细执行信息 | 开发调试和问题诊断 | 信息详尽，便于排查 |

### 使用示例

```java
// 单一模式
Flux<StreamingData> stream = graph.stream(input, List.of("messages"));

// 组合模式
Flux<StreamingData> stream = graph.stream(input,
    List.of("custom", "updates"));

// 调试模式
Flux<StreamingData> stream = graph.stream(input,
    List.of("debug", "values"));
```

## 技术优势

### 实时反馈机制
流式处理消除了传统批处理模式中的等待时间，用户可以立即获得系统响应，提升了应用的交互性和响应速度。

### 处理过程透明化
通过中间状态的实时推送，用户和开发者可以清楚了解系统的执行进度和当前状态，增强了系统的可观测性。

### 感知性能优化
即使在处理复杂任务时，持续的状态更新也能让用户感知到系统的活跃状态，有效改善了用户的等待体验。

### 调试和监控支持
详细的执行信息流为开发者提供了强大的调试能力，便于快速定位问题和优化系统性能。

## 应用场景

### 对话式应用
在智能客服、聊天机器人等对话式应用中，流式输出可以实现逐字符的文本展示，模拟真实的对话体验。系统可以在生成回复的同时将令牌实时推送给客户端，避免用户长时间等待。

### 复杂工作流处理
对于包含多个处理步骤的工作流，流式输出能够实时显示每个阶段的执行状态和中间结果。例如在文档处理流程中，系统可以依次推送"文档解析中"、"内容提取中"、"摘要生成中"等状态信息。

### 大规模数据处理
在处理大量数据时，通过流式输出可以实时显示处理进度、已完成的数据量以及预估的剩余时间。这对于批量数据导入、报表生成等长时间运行的任务特别有用。

### 外部服务集成
当工作流需要调用外部 API 或服务时，流式输出可以提供调用状态、响应时间等实时信息，帮助用户了解外部依赖的执行情况。

### 多智能体协作
在多个智能体协同工作的场景中，流式输出可以展示各个智能体的工作状态和协作过程，让用户了解任务的分工和执行进度。

## 下一步

- [智能体流式处理](./agent-streaming) - 学习如何从智能体流式传输数据
- [工作流流式处理](./workflow-streaming) - 了解工作流的流式处理
- [自定义流式数据](./custom-streaming) - 发送自定义流式数据
- [性能优化](./performance) - 优化流式处理性能
